<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports PS-PP1</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    .header {
      background-color: #f2f2f2;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      font-size: 40px;
      margin: 0;
    }
    .header p {
      font-size: 14px;
      margin: 0;
    }
    .header img {
      height: 150px;
      margin-left: 0px;
    }
    h1 {
      font-size: 28px;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      margin-bottom: 0px;
    }
    .menu {
      margin-bottom: 0px;
    }
    .menu a {
      display: block;
      margin-bottom: 5px;
      cursor: pointer;
      color: #007bff;
    }
    .important {
      color: red;
      font-weight: bold;
    }
    .nav-buttons {
      margin-bottom: 20px; /* Space between the buttons and the content */
    }
    .nav-button,
    .back-button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
      text-decoration: none;
      margin-right: 10px;
    }
    .nav-button:hover,
    .back-button:hover {
      background-color: #0056b3;
    }
    .back-button {
      background-color: #dc3545;
    }
    .back-button:hover {
      background-color: #c82333;
    }
    .section-title {
      margin-top: 1.5em;
      border-bottom: 2px solid #333;
      padding-bottom: 0.5em;
      font-size: 1.2em;
    }
    .pdf-container {
      width: 75%;
      height: 800px;
      overflow-y: auto;
      border: 1px solid #ccc;
      margin-top: 20px;
      display: none;
    }
    .pdf-container embed,
    .pdf-container iframe {
      width: 100%;
      height: 100%;
    }
    .back-button {
      display: none;
      margin-top: 10px;
      cursor: pointer;
      color: #007bff;
      background: none;
      border: none;
      font-size: 16px;
      text-decoration: underline;
    }
    code {
      font-family: monospace;
      background: #f4f4f4;
      padding: 0.2em 0.4em;
      border-radius: 3px;
    }
    .sub-list {
      margin-left: 20px;
    }
    .content {
      display: none;
    }
    .content.active {
      display: block;
    }
      /* Add new styles for histogram section */
      .histogram-container {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .histogram {
      width: 600px;
      height: 400px;
      border: 1px solid #ccc;
    }
    .histogram img {
      max-width: 100%;
      height: auto;
    }
  </style>
  <script src="https://root.cern/js/latest/jsroot.js"></script>
</head>
<body>

<div class="header">
  <div>
    <h1>CMS Cables OT Phase II</h1>
    <p>INFN-Sez.Perugia</p>
  </div>
  <div>
    <img src="https://www.sharper-night.it/wp-content/uploads/event-manager-uploads/organizer_logo/2022/09/INFN_NOME_ESTESO.png" alt="First Figure">
    <img src="https://tikz.net/wp-content/uploads/2023/09/CMS_logo-007.png" alt="Second Figure">
  </div>
</div>
<hr>

<!-- Navigation Buttons -->
<div class="nav-buttons">
  <button class="nav-button" onclick="showHome()">Home</button>
  <button class="nav-button" onclick="showDocumentation()">Documentation</button>
</div>

<!-- Home Content -->
<div id="homeContent" class="content active">
  <ul>
    <li><b>This page will be updated automatically once a day if new reports have been produced (at 3:45 PM).</b></li>
    <br>
    <li>The script to produce the reports is stored in this <a href="https://github.com/ldellape/CMScables" target="_blank">GitHub page</a></li> 
  </ul>

<!-- Reports Section -->
<h1>Reports PS-PP1:</h1>
<p>Reports are produced for continuity and/or isolation tests, including LV/LVR resistance versus time acquisition.</p>
<div class="menu" id="menu">
  <a onclick="toggleMenu('Cable01')">Cable01</a>
  <a onclick="toggleMenu('Cable02')">Cable02</a>
  <a onclick="toggleMenu('Cable03')">Cable03</a>
</div>
<div>
  <button class="back-button" id="backButton" onclick="showMenu()">Back</button>
</div>

<ul id="fileList"></ul>

<div class="pdf-container" id="pdfContainer"></div>
<hr>
Structure of the Cable: <br>
<img src="./docs/immagine_2024-07-16_112623860.png" alt="Cable Structure" width="300px" heigh="200px">
<hr>

<h2 class="section-title">Cable Structure and Histograms</h2>
<div class="histogram-container">
  <!-- Containers for histograms -->
  <div id="histogram1" class="histogram"></div>
  <div id="histogram2" class="histogram"></div>
</div>

Contact: luca.dellapenna@cern.ch or luca.dellapenna@pg.infn.it
</div>

<!-- Documentation Content -->
<div id="documentationContent" class="content">
  <h2 class="section-title">CMScables Documentation</h2>

  <p class="important">DO NOT MODIFY THE TXT FILES PROVIDED BY CEETIS!</p>

  <h2 class="section-title">Modes of Operation</h2>
  <ol>
    <li>
      AUTOMATIC MODE:
      <p>Processes the results of the most recent test in chronological order. Generates a final report with or without LV/LVR/PHR cables resistance versus time. (AUTO_TEST)</p>
    </li>
    <li>
      MANUAL MODE:
      <p>Allows selection of one or more tests by navigating through directories. Options include:</p>
      <ul class="sub-list">
        <li>a-Choosing specific tests from the directory <code>./input/FULL_TEST_su_cavo_ps_pp1_V3</code></li>
        <li>b-Deciding whether to plot results for comparison</li>
        <li>c-Selecting the type of test to plot (continuity, isolation, or both)</li>
        <li>d-Including LV cables resistance versus time plots</li>
        <li>e-Determining if a final report should be produced</li><p></p>
      </ul>
    </li>
    <li>
      COMMAND LINE MODE:
      <p>Run CMScables from the command line with:</p>
      <pre><code>./CMScables --input [PATH_TO_TXT_FILE] --mode [OPTION]</code></pre>
      <p>Parameters:</p>
      <ul class="sub-list">
        <li><code>[PATH_TO_TXT_FILE]</code> should be in the format <code>CableXX/NAME_OF_THE_TEST.txt</code></li>
        <li><code>[OPTION]</code> can be 0 (continuity), 1 (isolation), or 2 (both). Default is continuity test.</li>
      </ul>
    </li>
  </ol>

  <h2 class="section-title">Adding New Tests to Plot</h2>
  <ol>
    <li>Copy the <code>.txt</code> file from CEETIS into <code>./input/FULL_TEST_su_cavo_ps_pp1_V3/CABLE_NAME/</code></li>
    <li>Copy the <code>.pdf</code> file into <code>./input/pdf_ceetis/</code></li>
    <li>Copy the <code>.ini</code> files into <code>./input/FULL_TEST_su_cavo_ps_pp1_V3/</code></li>
  </ol>

  <h2 class="section-title">Adding New Sections to the Report</h2>
  <ol>
    <li>In <code>CMScables.py</code>:</li>
    <ul class="sub-list">
      <li>Locate the function <code>run_Cable_Plot_and_Report(...)</code></li>
      <li>Add the function you want to call. Example: <code>write_pdf.add_test_measure(fig, ax, f1, label1, color1, legend1, ...)</code></li>
    </ul>
    <li>In <code>write_pdf.py</code>:</li>
    <ul class="sub-list">
      <li>Add the desired function definition. Example:</li>
      <pre><code>def add_test_measure(fig, ax, f1, label1, color1, legend1, ...):
    // Function implementation</code></pre>
    </ul>
  </ol>
</div>

<script>
  function showHome() {
    document.getElementById('homeContent').classList.add('active');
    document.getElementById('documentationContent').classList.remove('active');
  }

  function showDocumentation() {
    document.getElementById('homeContent').classList.remove('active');
    document.getElementById('documentationContent').classList.add('active');
  }

  function toggleMenu(cable) {
    var menuItems = document.querySelectorAll('.menu a');
    menuItems.forEach(item => item.style.display = 'block');
    document.getElementById('menu').style.display = 'none';
    document.getElementById('backButton').style.display = 'block';
    loadFiles(cable);
  }

  function showMenu() {
    var menuItems = document.querySelectorAll('.menu a');
    menuItems.forEach(item => item.style.display = 'block');
    document.getElementById('menu').style.display = 'block';
    document.getElementById('backButton').style.display = 'none';
    document.getElementById('fileList').innerHTML = '';
    document.getElementById('pdfContainer').style.display = 'none';
  }

  function loadFiles(cable) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', './input/FULL_TEST_su_cavo_ps_pp1_V3/' + cable + '/');
    xhr.onload = function() {
      if (xhr.status === 200) {
        var parser = new DOMParser();
        var doc = parser.parseFromString(xhr.responseText, 'text/html');
        var links = doc.querySelectorAll('a');
        var fileList = document.getElementById('fileList');
        fileList.innerHTML = '';
        links.forEach(function(link) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          a.textContent = link.textContent;
          a.href = './input/FULL_TEST_su_cavo_ps_pp1_V3/' + cable + '/' + link.textContent;
          a.target = '_blank';
          a.onclick = function(event) {
            event.preventDefault();
            showPDF(a.href);
          };
          li.appendChild(a);
          fileList.appendChild(li);
        });
      }
    };
    xhr.send();
  }

  function showPDF(url) {
    var pdfContainer = document.getElementById('pdfContainer');
    pdfContainer.style.display = 'block';
    pdfContainer.innerHTML = '<embed src="' + url + '" type="application/pdf">';
  }

  // Function to draw histograms
  function drawHistogram(divId, fileName, histName) {
    JSROOT.openFile(fileName).then(file => {
      file.readObject(histName).then(obj => {
        JSROOT.draw(divId, obj);
      });
    });
  }

  // Load histograms on page load
  document.addEventListener('DOMContentLoaded', function() {
    drawHistogram('histogram1', 'statistics.root', 'h_HV_ResistenceContinuity');
    drawHistogram('histogram2', 'statistics.root', 'h_LV_ResistenceContinuity');
  });
</script>

</body>
</html>
